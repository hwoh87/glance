> [!TIP] 🗣️ 핵심내용
Jetpack Glance는 Jetpack Compose 스타일로 Android 위젯을 개발할 수 있는 라이브러리입니다. 선언형 UI로 위젯을 더 쉽게 만들어보세요.
>

## 1. Glance란?
Jetpack Glance는 Android 홈 화면 위젯을 **Compose 스타일의 선언형 DSL**로 작성할 수 있게 해주는 라이브러리입니다.

### 1.1 핵심 특징
- **선언형 UI**: XML이 아닌 Kotlin 코드로 UI 작성
- **RemoteViews 추상화**: 복잡한 RemoteViews API를 Compose 스타일로 간소화
- **DataStore 통합**: PreferencesGlanceStateDefinition으로 쉬운 상태 관리
- **Material3 지원**: 일관된 디자인 시스템

> [!NOTE]
> **선언형 UI**는 Glance의 핵심 특징입니다. 전통적인 위젯 개발에서는 XML로 레이아웃을 정의하고 RemoteViews API로 각 요소를 개별적으로 조작해야 했지만, Glance에서는 Compose와 유사한 방식으로 Kotlin 코드로 직접 UI를 선언할 수 있습니다.
>
> **RemoteViews 추상화**를 통해 개발자는 복잡한 RemoteViews API를 직접 다루지 않아도 됩니다. Glance가 선언형 DSL을 내부적으로 RemoteViews로 자동 변환하여 처리합니다.
>
> **DataStore 통합**은 위젯 상태 관리를 크게 간소화합니다. SharedPreferences를 수동으로 관리하던 전통적인 방식과 달리, StateDefinition을 지정하기만 하면 각 위젯 인스턴스별로 상태가 자동으로 분리되어 관리됩니다.

### 1.2 전통 위젯과의 차이

| 항목        | 전통 위젯                                         | Glance 위젯                                                                          |
| --------- | --------------------------------------------- | ------------------------------------------------------------------------------------ |
| UI 작성     | XML + RemoteViews                             | Compose DSL                                                                          |
| 상태 관리     | 직접 구현 (SharedPreferences)                     | DataStore 기반 StateDefinition → **[6. State 관리⭐](6.%20State%20관리⭐.md)** 참고        |
| 시스템 업데이트  | `onUpdate()` 콜백 (시스템이 자동 호출)                  | 자동 처리 (프레임워크가 `provideGlance` 호출)                                                    |
| 앱 내부 업데이트 | `AppWidgetManager.updateAppWidget()` (명시적 호출) | `update()` / `updateAll()` (명시적 호출)                                                 |
| 개발 경험     | 보일러플레이트 많음                                    | 간결하고 직관적                                                                           |

> [!NOTE] 💬 업데이트 방식의 차이
> **전통 위젯**:
> - **시스템 업데이트**: 주기적 업데이트, 재부팅, 사이즈 변경 등 시스템 이벤트가 발생하면 `onUpdate()` 콜백이 **자동으로** 호출됩니다.
> - **앱 내부 업데이트**: 앱 로직(버튼 클릭, 데이터 갱신 등)에서 업데이트가 필요하면 `AppWidgetManager.updateAppWidget()`을 **명시적으로** 호출해야 합니다.
>
> **Glance 위젯**:
> - **시스템 업데이트**: Glance 프레임워크가 시스템 이벤트를 감지하고 **자동으로** `provideGlance()`를 호출합니다. 개발자가 신경 쓸 필요 없습니다.
> - **앱 내부 업데이트**: ActionCallback, Worker 등에서 상태를 변경한 후 `MyWidget().update(context, glanceId)` 또는 `updateAll(context)`를 **명시적으로** 호출해야 UI가 갱신됩니다.
>
> 💡 **핵심**: 두 방식 모두 **시스템 이벤트는 자동**, **앱 내부 로직은 명시적 호출** 필요합니다. 차이점은 Glance가 시스템 이벤트 처리를 프레임워크 레벨에서 추상화했다는 점입니다.
>
> 자세한 내용: **[5. 생명주기 & 업데이트 트리거⭐⭐](5.%20Glance%20생명주기%20&%20업데이트%20트리거⭐.md)**

---

## 2. Glance 위젯 구조

```
📦 Glance 위젯 구성요소
├─ 📡 GlanceAppWidgetReceiver → [2. GlanceAppWidgetReceiver](2.%20GlanceAppWidgetReceiver.md)
│   └─ 시스템 브로드캐스트 수신 (진입점)
│
├─ 🧩 GlanceAppWidget → [4. GlanceAppWidget](4.%20GlanceAppWidget.md)
│   ├─ stateDefinition → [6. State 관리](6.%20State%20관리.md)
│   ├─ sizeMode → [8. SizeMode](8.%20SizeMode.md)
│   └─ provideGlance() (UI 제공)
│
├─ 🎨 Composable UI → [7. UI 작성 규칙](7.%20UI%20작성%20규칙%20및%20제약사항.md)
│   ├─ Column, Row, Box
│   ├─ Text, Image, Button
│   └─ currentState() (상태 읽기)
│
└─ 🔄 ActionCallback → [9. Action 처리 방식](9.%20Action(이벤트)%20처리%20방식.md)
    └─ 사용자 인터랙션 처리
```

> [!NOTE]
> Glance 위젯은 4가지 핵심 요소로 구성됩니다:
>
> 1. **GlanceAppWidgetReceiver**: 시스템 진입점으로, 런처나 OS에서 전송하는 브로드캐스트를 수신하여 위젯을 활성화합니다.
>
> 2. **GlanceAppWidget**: 위젯의 핵심 클래스로, 상태 관리 방식(`stateDefinition`), 크기 대응 전략(`sizeMode`), UI 정의(`provideGlance`)를 담당합니다.
>
> 3. **Composable UI**: Compose 스타일의 선언형 UI로, `Column`, `Row`, `Text`, `Button` 등의 컴포넌트를 사용하며, `currentState()`를 통해 상태를 읽어옵니다.
>
> 4. **ActionCallback**: 사용자 인터랙션(버튼 클릭 등)을 처리하며, 이를 통해 상태를 변경하고 위젯 UI를 업데이트합니다.

---

## 3. 최소 구현 예제

```kotlin
// 1. Receiver 정의
class SimpleWidgetReceiver : GlanceAppWidgetReceiver() {
    override val glanceAppWidget: GlanceAppWidget = SimpleWidget()
}

// 2. Widget 구현
class SimpleWidget : GlanceAppWidget() {
    override suspend fun provideGlance(context: Context, id: GlanceId) {
        provideContent {
            Column(
                modifier = GlanceModifier
                    .fillMaxSize()
                    .padding(16.dp)
                    .background(Color.White),
                verticalAlignment = Alignment.CenterVertically,
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                Text(
                    text = "Hello, Glance!",
                    style = TextStyle(fontSize = 20.sp, fontWeight = FontWeight.Bold)
                )
            }
        }
    }
}
```

```xml
<!-- 3. AndroidManifest.xml 등록 -->
<receiver
    android:name=".SimpleWidgetReceiver"
    android:exported="true">
    <intent-filter>
        <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
    </intent-filter>
    <meta-data
        android:name="android.appwidget.provider"
        android:resource="@xml/simple_widget_info" />
</receiver>
```

```xml
<!-- 4. res/xml/simple_widget_info.xml -->
<appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"
    android:initialLayout="@layout/placeholder"
    android:minWidth="180dp"
    android:minHeight="110dp"
    android:resizeMode="horizontal|vertical"
    android:widgetCategory="home_screen" />
```

```xml
<!-- 5. res/layout/placeholder.xml -->
<TextView xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:text="Loading..."
    android:gravity="center"
    android:background="#FFFFFF" />
```

**[스크린샷 추천]** 홈 화면에 표시된 "Hello, Glance!" 위젯

> [!NOTE]
> 이 최소 구현 예제는 Glance 위젯 개발의 간결함을 보여줍니다:
>
> 1. **Receiver 정의**: `GlanceAppWidgetReceiver`를 상속하고 위젯 클래스를 연결합니다.
>
> 2. **Widget 구현**: `provideContent` 블록 내에서 Compose 스타일로 UI를 선언합니다. `Column`으로 레이아웃을 구성하고 `Text`로 내용을 표시합니다.
>
> 3. **Manifest 등록**: 일반 `BroadcastReceiver`와 동일하게 등록하며, `AppWidgetProviderInfo` XML을 메타데이터로 연결합니다.
>
> 4. **ProviderInfo XML**: 위젯의 기본 정보(크기, 리사이즈 모드, 카테고리)를 정의합니다. `initialLayout`은 로딩 중 표시될 플레이스홀더를 지정합니다.
>
> 5. **플레이스홀더 레이아웃**: 위젯이 완전히 로드되기 전 임시로 표시되는 간단한 레이아웃입니다. "Loading..." 텍스트 정도면 충분합니다.
>
> 이 5가지 구성요소만으로 기본적인 Glance 위젯을 완성할 수 있습니다.

---
