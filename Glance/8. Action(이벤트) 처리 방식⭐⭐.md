> [!TIP] ğŸ—£ï¸ í•µì‹¬ë‚´ìš©
ì‚¬ìš©ì ì¸í„°ë™ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•: actionRunCallback, actionStartActivity, actionStartService ë“±ì„ ë‹¤ë£¹ë‹ˆë‹¤.
>

## 1. Action ê°œìš”

Glance ìœ„ì ¯ì—ì„œ ì‚¬ìš©ìì˜ í´ë¦­, íƒ­ ë“±ì˜ ì¸í„°ë™ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. RemoteViews ê¸°ë°˜ì´ë¯€ë¡œ PendingIntentë¥¼ í†µí•´ ë™ì‘í•©ë‹ˆë‹¤.

```
ğŸ‘† ì‚¬ìš©ì í´ë¦­
   â”‚
   â–¼
ğŸ¯ clickable(onClick = action...)
   â”‚
   â–¼
ğŸ“¡ PendingIntent ì‹¤í–‰
   â”‚
   â”œâ”€â†’ ğŸ”„ `actionRunCallback` (ìœ„ì ¯ ë‚´ë¶€ ë¡œì§)
   â”œâ”€â†’ ğŸ“± `actionStartActivity` (ì•¡í‹°ë¹„í‹° ì‹¤í–‰)
   â””â”€â†’ âš™ï¸ `actionStartService` (ì„œë¹„ìŠ¤ ì‹¤í–‰)
```

---

## 2. Action ìœ í˜•

### 2.1 `actionRunCallback`
- **ê°€ì¥ ë§ì´ ì‚¬ìš©**í•˜ëŠ” ë°©ì‹
- ìœ„ì ¯ ë‚´ë¶€ì—ì„œ **ìƒíƒœ ë³€ê²½ + UI ê°±ì‹ **ì„ ì²˜ë¦¬
- `ActionCallback` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ í•„ìš”

```kotlin
class CounterWidget : GlanceAppWidget() {
    override suspend fun provideGlance(context: Context, id: GlanceId) {
        provideContent {
            val prefs = currentState<Preferences>()
            val count = prefs[intPreferencesKey("count")] ?: 0

            Column(
                modifier = GlanceModifier.fillMaxSize(),
                verticalAlignment = Alignment.CenterVertically,
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                Text("Count: $count")
                Button(
                    text = "ì¦ê°€",
                    onClick = actionRunCallback<IncrementAction>()
                )
            }
        }
    }
}

// ActionCallback êµ¬í˜„
class IncrementAction : ActionCallback {
    override suspend fun onAction(
        context: Context,
        glanceId: GlanceId,
        parameters: ActionParameters
    ) {
        // 1. ìƒíƒœ ì—…ë°ì´íŠ¸
        updateAppWidgetState(context, glanceId) { prefs ->
            val current = prefs[intPreferencesKey("count")] ?: 0
            prefs[intPreferencesKey("count")] = current + 1
        }

        // 2. UI ê°±ì‹  (í•„ìˆ˜!)
        CounterWidget().update(context, glanceId)
    }
}
```

> [!NOTE] ğŸ’¬ ë°œí‘œ ì„¤ëª…
> "**ActionCallbackì˜ ì‹¤í–‰ íë¦„**ì„ ì´í•´í•˜ëŠ” ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤.
>
> 1. **ì‚¬ìš©ì í´ë¦­**: ì‚¬ìš©ìê°€ Buttonì„ íƒ­í•˜ë©´ `onClick = actionRunCallback<IncrementAction>()`ì´ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.
>
> 2. **ì‹œìŠ¤í…œ í˜¸ì¶œ**: Glance ì‹œìŠ¤í…œì´ IncrementAction í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³  `onAction()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ **ë¦¬í”Œë ‰ì…˜**ì´ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ProGuard ê·œì¹™ì´ í•„ìš”í•œ ê±°ì£ .
>
> 3. **ìƒíƒœ ì—…ë°ì´íŠ¸**: `updateAppWidgetState()`ë¡œ DataStoreì— ìƒˆë¡œìš´ ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ê²ƒë§Œìœ¼ë¡œëŠ” í™”ë©´ì´ ì•ˆ ë°”ë€ë‹ˆë‹¤!
>
> 4. **UI ê°±ì‹ **: `CounterWidget().update()`ë¥¼ í˜¸ì¶œí•´ì•¼ `provideGlance()`ê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ë©´ì„œ í™”ë©´ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. **ì´ ë‹¨ê³„ë¥¼ ë¹¼ë¨¹ìœ¼ë©´ í´ë¦­í•´ë„ ì•„ë¬´ ì¼ë„ ì•ˆ ì¼ì–´ë‚˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.**
>
> **í•µì‹¬**: ActionCallbackì€ ë‹¨ìˆœíˆ ë¡œì§ë§Œ ì‹¤í–‰í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ 'ìƒíƒœ ë³€ê²½ â†’ UI ê°±ì‹ ' ë‘ ë‹¨ê³„ë¥¼ ëª¨ë‘ ì±…ì„ì§‘ë‹ˆë‹¤."

**[ìŠ¤í¬ë¦°ìƒ· ì¶”ì²œ]** ë²„íŠ¼ í´ë¦­ ì‹œ ì¹´ìš´í„°ê°€ ì¦ê°€í•˜ëŠ” ìœ„ì ¯ í™”ë©´

---

### 2.2 `actionStartActivity`
- íŠ¹ì • **Activityë¥¼ ì‹¤í–‰**í•  ë•Œ ì‚¬ìš©
- ìœ„ì ¯ì—ì„œ ì•±ì˜ ë©”ì¸ í™”ë©´ì´ë‚˜ íŠ¹ì • ê¸°ëŠ¥ìœ¼ë¡œ ì´ë™

```kotlin
Button(
    text = "ì•± ì—´ê¸°",
    onClick = actionStartActivity<MainActivity>()
)

// íŒŒë¼ë¯¸í„° ì „ë‹¬
Button(
    text = "ìƒì„¸ë³´ê¸°",
    onClick = actionStartActivity(
        Intent(context, DetailActivity::class.java).apply {
            putExtra("item_id", itemId)
        }
    )
)

// ComponentNameìœ¼ë¡œ ì§€ì •
Button(
    text = "ì„¤ì • ì—´ê¸°",
    onClick = actionStartActivity(
        ComponentName(context, SettingsActivity::class.java)
    )
)
```

---

### 2.3 `actionStartService` (Deprecated)
- Android 8.0(API 26)ë¶€í„° ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ ì œí•œìœ¼ë¡œ **ì‚¬ìš© ê¶Œì¥í•˜ì§€ ì•ŠìŒ**
- ëŒ€ì‹  **WorkManager** ë˜ëŠ” **`actionRunCallback`**ì—ì„œ ì‘ì—… ì²˜ë¦¬

```kotlin
// âŒ ê¶Œì¥í•˜ì§€ ì•ŠìŒ
onClick = actionStartService<MyService>()

// âœ… ëŒ€ì•ˆ: actionRunCallbackì—ì„œ WorkManager ì‚¬ìš©
class RefreshAction : ActionCallback {
    override suspend fun onAction(
        context: Context,
        glanceId: GlanceId,
        parameters: ActionParameters
    ) {
        // WorkManagerë¡œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì˜ˆì•½
        val workRequest = OneTimeWorkRequestBuilder<RefreshWorker>().build()
        WorkManager.getInstance(context).enqueue(workRequest)

        // UI ì¦‰ì‹œ ê°±ì‹ 
        MyWidget().update(context, glanceId)
    }
}
```

---

### 2.4 `action` (ì»¤ìŠ¤í…€ Action)
- ì›ì‹œì ì¸ ë°©ë²•: ì§ì ‘ `PendingIntent` ìƒì„±
- íŠ¹ìˆ˜í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš© (ë¸Œë¡œë“œìºìŠ¤íŠ¸ ìˆ˜ì‹  ë“±)

```kotlin
Button(
    text = "ì»¤ìŠ¤í…€ ì•¡ì…˜",
    onClick = action(
        Intent(context, MyReceiver::class.java).apply {
            action = "com.example.CUSTOM_ACTION"
            putExtra("data", "value")
        }
    )
)
```

---

## 3. `ActionParameters`ë¡œ ë°ì´í„° ì „ë‹¬

`ActionCallback`ì— íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
// 1. íŒŒë¼ë¯¸í„° ì •ì˜
val itemIdKey = ActionParameters.Key<Int>("item_id")

// 2. í´ë¦­ ì‹œ íŒŒë¼ë¯¸í„° ì „ë‹¬
Button(
    text = "í•­ëª© ì‚­ì œ",
    onClick = actionRunCallback<DeleteItemAction>(
        parameters = actionParametersOf(itemIdKey to itemId)
    )
)

// 3. ActionCallbackì—ì„œ íŒŒë¼ë¯¸í„° ìˆ˜ì‹ 
class DeleteItemAction : ActionCallback {
    override suspend fun onAction(
        context: Context,
        glanceId: GlanceId,
        parameters: ActionParameters
    ) {
        val itemId = parameters[itemIdKey] ?: return

        // ì‚­ì œ ë¡œì§
        deleteItem(itemId)

        // UI ê°±ì‹ 
        MyWidget().update(context, glanceId)
    }
}
```

> [!NOTE] ğŸ’¬ ë°œí‘œ ì„¤ëª…
> "**ActionParametersëŠ” RemoteViewsì˜ PendingIntent ì œì•½ì„ ìš°íšŒí•˜ëŠ” ë°©ë²•**ì…ë‹ˆë‹¤.
>
> RemoteViewsëŠ” ì¼ë°˜ì ì¸ Composeì²˜ëŸ¼ ëŒë‹¤ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª¨ë“  ê²ƒì´ PendingIntentë¥¼ í†µí•´ì•¼ í•˜ë‹ˆê¹Œìš”. ê·¸ë˜ì„œ GlanceëŠ” **Key-Value ì‹œìŠ¤í…œ**ì„ ì œê³µí•©ë‹ˆë‹¤.
>
> 1. **Key ì •ì˜**: `ActionParameters.Key<Int>("item_id")` - íƒ€ì… ì•ˆì „í•œ í‚¤ë¥¼ ë§Œë“­ë‹ˆë‹¤.
> 2. **ì „ë‹¬**: `actionParametersOf(itemIdKey to itemId)` - í´ë¦­í•  ë•Œ ë°ì´í„°ë¥¼ í•¨ê»˜ ë³´ëƒ…ë‹ˆë‹¤.
> 3. **ìˆ˜ì‹ **: `parameters[itemIdKey]` - ActionCallbackì—ì„œ ì•ˆì „í•˜ê²Œ êº¼ëƒ…ë‹ˆë‹¤.
>
> ì´ë ‡ê²Œ í•˜ë©´ ë¦¬ìŠ¤íŠ¸ ìœ„ì ¯ì—ì„œ **ì–´ë–¤ í•­ëª©ì„ í´ë¦­í–ˆëŠ”ì§€** êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°™ì€ ActionCallback í´ë˜ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•˜ë©´ì„œë„ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì£ ."

**[ìŠ¤í¬ë¦°ìƒ· ì¶”ì²œ]** ë¦¬ìŠ¤íŠ¸ ìœ„ì ¯ì—ì„œ ê° í•­ëª©ì˜ ì‚­ì œ ë²„íŠ¼ ì˜ˆì‹œ

---

## 4. ë³µí•© Action íŒ¨í„´

### 4.1 ì¡°ê±´ë¶€ Action
```kotlin
Button(
    text = if (isLoggedIn) "ë¡œê·¸ì•„ì›ƒ" else "ë¡œê·¸ì¸",
    onClick = if (isLoggedIn) {
        actionRunCallback<LogoutAction>()
    } else {
        actionStartActivity<LoginActivity>()
    }
)
```

### 4.2 ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì— ë™ì¼ Action
```kotlin
@Composable
fun ClickableCard(data: String) {
    Box(
        modifier = GlanceModifier
            .fillMaxWidth()
            .padding(8.dp)
            .background(Color.White)
            .clickable(
                onClick = actionRunCallback<CardClickAction>(
                    parameters = actionParametersOf(dataKey to data)
                )
            )
    ) {
        Text(data)
    }
}
```

---

## 5. Action ì²˜ë¦¬ ì‹œ ì£¼ì˜ì‚¬í•­

### 5.1 ìƒíƒœ ë³€ê²½ í›„ ë°˜ë“œì‹œ `update()` í˜¸ì¶œ

ìƒíƒœë¥¼ ë³€ê²½í•œ í›„ì—ëŠ” **ë°˜ë“œì‹œ `update()`ë¥¼ í˜¸ì¶œ**í•´ì•¼ UIì— ë°˜ì˜ë©ë‹ˆë‹¤.

```kotlin
updateAppWidgetState(context, glanceId) { prefs ->
    prefs[someKey] = newValue
}
MyWidget().update(context, glanceId) // í•„ìˆ˜!
```

> [!NOTE] ğŸ’¬ ë°œí‘œ ì„¤ëª…
> "**ê°€ì¥ í”í•œ ì‹¤ìˆ˜**ê°€ ë°”ë¡œ `update()` í˜¸ì¶œì„ ê¹Œë¨¹ëŠ” ê²ë‹ˆë‹¤.
>
> `updateAppWidgetState()`ëŠ” DataStoreì— ë°ì´í„°ë§Œ ì €ì¥í•©ë‹ˆë‹¤. íŒŒì¼ì— ì“°ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•´ìš”. **í™”ë©´ ê°±ì‹ ê³¼ëŠ” ë³„ê°œì…ë‹ˆë‹¤.**
>
> `update()`ë¥¼ í˜¸ì¶œí•´ì•¼ `provideGlance()`ê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ê³ , `currentState<Preferences>()`ë¡œ ìƒˆë¡œìš´ ê°’ì„ ì½ì–´ì™€ì„œ UIê°€ ë‹¤ì‹œ ê·¸ë ¤ì§‘ë‹ˆë‹¤.
>
> ì´ ë‘ ë‹¨ê³„ê°€ ë¶„ë¦¬ëœ ì´ìœ ëŠ” **ë°°ì¹˜ ì—…ë°ì´íŠ¸**ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œì…ë‹ˆë‹¤. ì—¬ëŸ¬ ìƒíƒœë¥¼ í•œ ë²ˆì— ë°”ê¾¸ê³  ë§ˆì§€ë§‰ì— ë”± í•œ ë²ˆë§Œ `update()`ë¥¼ í˜¸ì¶œí•˜ë©´ ë˜ë‹ˆê¹Œìš”."

**ì—…ë°ì´íŠ¸ ë©”ì„œë“œì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ â†’ [5. Glance ìƒëª…ì£¼ê¸° & ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°â­](5.%20Glance%20ìƒëª…ì£¼ê¸°%20&%20ì—…ë°ì´íŠ¸%20íŠ¸ë¦¬ê±°â­.md)** ì°¸ê³ 

### 5.2 ë¬´ê±°ìš´ ì‘ì—…ì€ `Worker`ë¡œ ë¶„ë¦¬
```kotlin
class HeavyAction : ActionCallback {
    override suspend fun onAction(
        context: Context,
        glanceId: GlanceId,
        parameters: ActionParameters
    ) {
        // âœ… ë„¤íŠ¸ì›Œí¬/DB ì‘ì—…ì€ WorkManagerë¡œ
        val workRequest = OneTimeWorkRequestBuilder<DataSyncWorker>()
            .setInputData(workDataOf("glance_id" to glanceId.toString()))
            .build()
        WorkManager.getInstance(context).enqueue(workRequest)

        // ì¦‰ì‹œ ë¡œë”© ìƒíƒœ í‘œì‹œ
        updateAppWidgetState(context, glanceId) { prefs ->
            prefs[booleanPreferencesKey("is_loading")] = true
        }
        MyWidget().update(context, glanceId)
    }
}
```

**[ë¹„ë””ì˜¤ ì¶”ì²œ]** ë²„íŠ¼ í´ë¦­ â†’ ë¡œë”© í‘œì‹œ â†’ ë°ì´í„° ë¡œë“œ ì™„ë£Œ â†’ ê²°ê³¼ í‘œì‹œ íë¦„

---

### 5.3 ì—ëŸ¬ ì²˜ë¦¬
```kotlin
class SafeAction : ActionCallback {
    override suspend fun onAction(
        context: Context,
        glanceId: GlanceId,
        parameters: ActionParameters
    ) {
        try {
            // ì‘ì—… ìˆ˜í–‰
            performTask()

            updateAppWidgetState(context, glanceId) { prefs ->
                prefs[stringPreferencesKey("status")] = "success"
            }
        } catch (e: Exception) {
            Log.e("SafeAction", "Error", e)
            updateAppWidgetState(context, glanceId) { prefs ->
                prefs[stringPreferencesKey("status")] = "error"
                prefs[stringPreferencesKey("error_msg")] = e.message ?: "Unknown"
            }
        } finally {
            MyWidget().update(context, glanceId)
        }
    }
}
```

---

## 6. ì‹¤ì „ ì˜ˆì œ: Todo ìœ„ì ¯

```kotlin
class TodoWidget : GlanceAppWidget() {
    override suspend fun provideGlance(context: Context, id: GlanceId) {
        provideContent {
            val prefs = currentState<Preferences>()
            val todos = prefs[stringPreferencesKey("todos")]?.split("|") ?: emptyList()

            Column(
                modifier = GlanceModifier.fillMaxSize().padding(16.dp)
            ) {
                Text("í•  ì¼ ëª©ë¡", style = TextStyle(fontSize = 18.sp, fontWeight = FontWeight.Bold))
                Spacer(GlanceModifier.height(8.dp))

                todos.forEach { todo ->
                    Row(
                        modifier = GlanceModifier.fillMaxWidth().padding(vertical = 4.dp),
                        verticalAlignment = Alignment.CenterVertically
                    ) {
                        Text(todo, modifier = GlanceModifier.defaultWeight())
                        Button(
                            text = "ì™„ë£Œ",
                            onClick = actionRunCallback<CompleteTodoAction>(
                                parameters = actionParametersOf(todoKey to todo)
                            )
                        )
                    }
                }

                Button(
                    text = "+ ì¶”ê°€",
                    onClick = actionStartActivity<AddTodoActivity>(),
                    modifier = GlanceModifier.fillMaxWidth()
                )
            }
        }
    }
}

class CompleteTodoAction : ActionCallback {
    override suspend fun onAction(
        context: Context,
        glanceId: GlanceId,
        parameters: ActionParameters
    ) {
        val todoToRemove = parameters[todoKey] ?: return

        updateAppWidgetState(context, glanceId) { prefs ->
            val todos = prefs[stringPreferencesKey("todos")]?.split("|")?.toMutableList() ?: mutableListOf()
            todos.remove(todoToRemove)
            prefs[stringPreferencesKey("todos")] = todos.joinToString("|")
        }

        TodoWidget().update(context, glanceId)
    }
}

private val todoKey = ActionParameters.Key<String>("todo_item")
```

**[ìŠ¤í¬ë¦°ìƒ· ì¶”ì²œ]** Todo ìœ„ì ¯ ì „ì²´ UI (ëª©ë¡ + ì™„ë£Œ ë²„íŠ¼ + ì¶”ê°€ ë²„íŠ¼)

---

---
